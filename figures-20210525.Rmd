---
title: "20230330-figures"
author: "Sujatha Jagannathan"
date: "3/30/2023"
output: html_document
---

### R set up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("readr")
library(tidyverse)
library("viridis")
library("RColorBrewer")
library("DT")
library("DataExplorer")
library("GGally")
library("ggthemes")
library("gridExtra")
library("ggfortify")
library("matrixStats")
library("pheatmap")
library("corrplot")
library("cowplot")
library(readxl)
library("ggpubr")

mytheme <- theme_few(base_size = 14) + 
                theme(
                  #aspect.ratio = 0.5, 
                  #legend.position = "none", 
                      panel.background = 
                          element_rect(
                              colour = "black", 
                              size=1))

# colors: https://bhaskarvk.github.io/colormap/ "cividis"

# colors
# dark_blue: "#042333ff"
# orange: "#f9a242ff"
# yellow: "#efe350ff"

# ff -> b2 for less opacity

```

### Data input
```{r}
deseq2_foldchange <- read_csv("data/deseq2-foldchange.csv")

yao_dux4_target_ddu251supp_table1 <- read_excel("data/ddu251supp_table1.xls", skip = 1)

target_genes <- yao_dux4_target_ddu251supp_table1[, c(1:2)]

```


##### Figure S1
```{r}
data <- deseq2_foldchange[, c(2:54)]

data_rna_long <- data %>% 
  filter(gene_biotype == "protein_coding") %>% 
  dplyr::select(ensembl_gene_id, gene_name = external_gene_name, baseMean_RNA, log2FoldChange.04h_RNA, log2FoldChange.08h_RNA, log2FoldChange.14h_RNA, padj.04h_RNA, padj.08h_RNA, padj.14h_RNA)  %>% 
  unite(log2FoldChange.04h_RNA, padj.04h_RNA, col = "4h", sep = "_") %>% 
  unite(log2FoldChange.08h_RNA, padj.08h_RNA, col = "8h", sep = "_") %>% 
  unite(log2FoldChange.14h_RNA, padj.14h_RNA, col = "14h", sep = "_") %>% 
  pivot_longer(cols = `4h`:`14h`, names_to = "time", values_to = "log2FoldChange_padj") %>% 
  separate(log2FoldChange_padj, sep = "_", into = c("log2FoldChange", "padj")) %>%
  mutate(target_status = ifelse(ensembl_gene_id %in% target_genes$Ensembl, "true", "false")) %>%
  mutate_at(vars(starts_with("log2")),funs(as.numeric)) %>%
  mutate_at(vars(starts_with("padj")),funs(as.numeric)) %>% 
  dplyr::arrange(target_status) %>%
  mutate(significance = ifelse(padj < 0.01, "true", "false")) %>%
  mutate(up_down = ifelse(log2FoldChange > 0, "up", "down"))

# Fig 2C - MA plot

colsa<-alpha(c("dark grey", "#042333"),c(.2,.7))
#names(colsa)<-c("target","non-target")

data_target <- data_rna_long %>% filter(target_status == "true")

# ggplot(data_rna_long, 
#             aes(
#               x = log10(baseMean_RNA), 
#               y = log2FoldChange)) + 
#   geom_point(aes(fill = target_status, color = target_status, pch = significance), size = 2)+ 
#   facet_wrap(~as_factor(time)) + 
#   scale_fill_manual(values = colsa,"DUX4 target status") +
#   scale_color_manual(values = colsa,"DUX4 target status") +
#   scale_shape_manual(values = c(1, 21)) + 
#   #theme(aspect.ratio = 1) +
#   #ggtitle("DUX4") + 
#   xlab(label = "log10 base expression") + 
#   ylab(label = "log2 fold change DUX4/control")  + mytheme + geom_hline(yintercept=0, linetype="dashed", color = "black")
    
ggplot(data_rna_long, 
            aes(
              x = log10(baseMean_RNA), 
              y = log2FoldChange)) + 
    geom_hex(bins = 40) + 
  scale_fill_distiller(
                    palette = 'PuBuGn',
                    direction = 1, 
                    #values = c(0, 0.5), 
                    element_text(size=5)) +
    xlab(label = "log10 base expression") + 
    ylab(label = "log2 fold change DUX4/control")  + 
    mytheme + 
    geom_hline(yintercept=0, linetype="dashed", color = "black") +
    facet_wrap(~as_factor(time)) +
    geom_point(data_target, 
             mapping = aes(
                           x = log10(baseMean_RNA), 
                           y = log2FoldChange),
             color='#042333',
             size=1,
             alpha=0.8) 
  
# number of significantly changed genes

temp <- data_rna_long %>% filter(significance == "true")
table(temp$time, temp$up_down)

  #     down   up
  # 14h 4080 4350
  # 4h   813  861
  # 8h  3077 3060
  
# colors
# dark_blue: "#042333ff"
# orange: "#f9a242ff"
# yellow: "#efe350ff"

# gene set analysis
# source of gene sets: https://www.gsea-msigdb.org/gsea/msigdb/search.jsp

data <- deseq2_foldchange[, c(2:54)]

# Fig 2D - Cluster analysis
data <- deseq2_foldchange[, c(2:54)]

# significant at any time point
sig_any <- data %>% filter(gene_biotype == "protein_coding") %>% dplyr::select(ensembl_gene_id, external_gene_name, log2FoldChange.04h_RNA, log2FoldChange.08h_RNA, log2FoldChange.14h_RNA, padj.04h_RNA, padj.08h_RNA, padj.14h_RNA) %>% filter((padj.04h_RNA < 0.01 & abs(log2FoldChange.04h_RNA) > 1) | (padj.08h_RNA < 0.01 & abs(log2FoldChange.08h_RNA) > 1) | (padj.14h_RNA < 0.01 & abs(log2FoldChange.14h_RNA) > 1)) %>% unique()
sig_any <- sig_any[complete.cases(sig_any), ]
nrow(sig_any)
#6109

# calculating # of clusters by elbow method
# any
set.seed(20)
k.max <- 15
sig_any_cluster <- sig_any[,3:5]
wss <- sapply(1:k.max,
function(k){kmeans(sig_any_cluster, k, nstart=50,iter.max = 15 )$tot.withinss})

plot(1:k.max, wss,
type="b", pch = 19, frame = FALSE,
xlab="Number of clusters K",
ylab="Total within-clusters sum of squares - any")

# plotting k-means clusters

mat_breaks = seq(-5, 5, by = 0.5)

set.seed(123)
sig_any_cluster_kmeans <- pheatmap(
  mat = sig_any_cluster, 
  color = cividis(22), 
  breaks = mat_breaks, 
  border_color = "black",
  kmeans_k = 5, 
  cluster_cols = FALSE)

# trying to rename/reorder the clusters to swap the order of 3 and 2. 
# sig_any_cluster_kmeans$tree_row$order <- c(1, 3, 2, 4, 5)

# Note: the above did not work. I am manually changing cluster 2 to be cluster 3 and vice versa to keep the narrative less confusing. 

sig_any_cluster_kmeans$kmeans$centers

# 5 clusters
#   log2FoldChange.04h_RNA log2FoldChange.08h_RNA log2FoldChange.14h_RNA
# 1              2.4530557              5.9421698               7.308791
# 2 -> 3         0.1404357              0.7416598               1.635063
# 3 -> 2         0.6880281              2.4240733               4.066411
# 4             -0.1708422             -0.8515180              -1.514691
# 5             -0.5851530             -2.3090253              -3.493314

sig_any_cluster_id <- tbl_df(cbind(ensembl_gene_id = sig_any$ensembl_gene_id, cluster = sig_any_cluster_kmeans$kmeans$cluster)) 

# reassigning clusters such that 2 -> 3 and 3 -> 2 to make further plotting easier
sig_any_cluster_id <- sig_any_cluster_id %>% mutate(cluster =replace(cluster, cluster==2, 6)) %>% mutate(cluster =replace(cluster, cluster==3, 2)) %>% mutate(cluster =replace(cluster, cluster==6, 3))

# join the data_clusters with fold change data to enable plotting 
sig_any_cluster_id <- right_join(sig_any, sig_any_cluster_id)

#supp. table 2
write.csv(sig_any_cluster_id, file = "data/sig_any_cluster_id-5c-new.csv")

# line plots for clusters

sig_any_cluster_id_long <- sig_any_cluster_id %>% dplyr::select(external_gene_name, log2FoldChange.04h_RNA:log2FoldChange.14h_RNA, cluster) %>%pivot_longer(cols = log2FoldChange.04h_RNA:log2FoldChange.14h_RNA, names_to = "time", values_to = "foldchange")

sig_any_cluster_id_long_mean <- sig_any_cluster_id_long %>% 
        group_by(cluster, time) %>% 
        summarise(foldchange = mean(foldchange))

ggplot(data = sig_any_cluster_id_long,
mapping = aes(x = time, y = foldchange, group = external_gene_name, color = cluster)) +
geom_line(aes(group = external_gene_name), alpha = .1) +
geom_line(data = sig_any_cluster_id_long_mean, aes(group = 1), alpha = 1, color = "black", size = 1) +
facet_grid(cols = vars(cluster)) +
scale_color_viridis(discrete=TRUE, direction = 1) + geom_hline(yintercept=0, linetype="dashed", color = "grey60", size= 2) + mytheme + ylim(-5, 10)

# GO analysis
GO_analysis_cluster_final <- read_delim("data/GO-analysis-cluster-final.txt", "\t", escape_double = FALSE, trim_ws = TRUE)

names(GO_analysis_cluster_final) <- c("GOBP", "genes-in-group", "genes-in-data", "expected", "fold-enrichment", "p-val", "fdr", "neglog10FDR", "cluster")

GO_analysis_cluster_final$GOBP <- factor(GO_analysis_cluster_final$GOBP, levels = GO_analysis_cluster_final$GOBP)

GO_analysis_cluster_final$cluster <- as.character(GO_analysis_cluster_final$cluster)

ggplot(data = GO_analysis_cluster_final, aes(x = GOBP, y = neglog10FDR, fill = cluster)) + geom_bar(stat="identity", color = "black") + scale_fill_viridis(discrete=TRUE, direction = 1) + mytheme

# pdf(file = "02-data/plots/go-analysis.pdf",width = 9,height = 2)
# print(g3)
# dev.off()

```

##### Figure 2

```{r}
# input data
load("data/DE_RiboRNA_coding.RData")

load("data/df_cpm_log2fc.RData")

dfa <- DE_RiboRNA_coding %>% select(gene_id:RiboRNA_padj, TPM_RNA:TPM_Ribo, condition, single_exon:gene_name_ok) %>% separate(gene_id, sep = "\\.", into = c("ensembl_gene_id", "extra")) %>%  mutate(target_status = ifelse(ensembl_gene_id %in% target_genes$Ensembl, "true", "false")) %>% mutate(significance = ifelse(Ribo_padj < 0.01, "true", "false"))  %>%
  mutate(up_down = ifelse(Ribo_log2FC > 0, "up", "down"))

dfa_target <- dfa %>% filter(target_status == "true")

colsa<-alpha(c("dark grey", "#042333"),c(.4,.7))
#names(colsa)<-c("target","non-target")

# ggplot(dfa %>% arrange(target_status), 
#             aes(
#               x = log10(Ribo_baseMean), 
#               y = Ribo_log2FC)) + 
#   geom_point(aes(fill = target_status, color = target_status, pch = significance), size = 2)+ 
#   facet_wrap(~as_factor(condition)) + 
#   scale_fill_manual(values = colsa,"DUX4 target status") +
#     scale_color_manual(values = colsa,"DUX4 target status") +
#   scale_shape_manual(values = c(1, 21)) + 
#   #theme(aspect.ratio = 1) +
#   #ggtitle("DUX4") + 
#   xlab(label = "log10 base expression") + 
#   ylab(label = "log2 fold change DUX4/control")  + mytheme + geom_hline(yintercept=0, linetype="dashed", color = "black")

p <- ggplot(dfa, 
            aes(
              x = log10(Ribo_baseMean), 
              y = Ribo_log2FC)) + 
    geom_hex(bins = 40) + 
  scale_fill_distiller(
                    palette = 'PuBuGn',
                    direction = 1, 
                    #values = c(0, 0.5), 
                    element_text(size=5)) +
    xlab(label = "log10 base expression") + 
    ylab(label = "log2 fold change DUX4/control")  + 
    mytheme + 
    geom_hline(yintercept=0, linetype="dashed", color = "black") +
    facet_wrap(~as_factor(condition)) +
    geom_point(dfa_target, 
             mapping = aes(
                           x = log10(Ribo_baseMean), 
                           y = Ribo_log2FC),
             color='#042333',
             size=1,
             alpha=0.8) 

p 

pdf(file = "data/orfquant_MA.pdf",width = 9,height = 3.5)
print(p)
dev.off()

# table to use for n for various categories  
DE_table <- dfa %>% filter(significance == "true")
table(DE_table$up_down, DE_table$experiment, DE_table$target_status)

  #      time04h_vs_time00h time08h_vs_time00h time14h_vs_time00h
  # down                122               1273               2398
  # up                  194               1153               2288
  
table(DE_table$tx_type_RiboRNA, DE_table$experiment)

  #                 time04h_vs_time00h time08h_vs_time00h time14h_vs_time00h
  # TE_down                          1                 22                154
  # TE_up                            0                  5                 55
  # Concordant_down                113               1166               2122
  # Concordant_up                  177               1062               2077
  # mixed_NS                        25                171                278

# RNA vs ribo correlation  

dfa_te <- DE_RiboRNA_coding %>% select(gene_id:RiboRNA_padj, TPM_RNA:TPM_Ribo, condition, single_exon:gene_name_ok) %>% separate(gene_id, sep = "\\.", into = c("ensembl_gene_id", "extra")) %>%  mutate(target_status = ifelse(ensembl_gene_id %in% target_genes$Ensembl, "true", "false")) %>% mutate(significance = ifelse(RiboRNA_padj < 0.01, "true", "false")) 

colsi <- alpha(c("#440154","#3CBB75","gray43","gray10","dark gray"),c(.8,.8,.3,.3,.1))
names(colsi) <- c("TE_down","TE_up","Concordant_down","Concordant_up","mixed_NS")

# colsi <- alpha(c("#440154","#3CBB75"),c(.8,.8))
# names(colsi) <- c("TE_down","TE_up")
# axm <- max(abs(c(dfa$RNA_log2FC,dfa$Ribo_log2FC)),na.rm = T)
# 
dfa_select <- dfa_te %>% filter(tx_type_RiboRNA %in% c("TE_down", "TE_up"))

ggplot(dfa_te %>% arrange(desc(tx_type_RiboRNA)),
            aes(x = RNA_log2FC, y = Ribo_log2FC,
                color = tx_type_RiboRNA,
                fill = tx_type_RiboRNA,
                shape = significance)) +
    geom_point(size = 2) +
    mytheme +
    ylab(paste("Ribo-seq "," log2FC\n",sep = "")) +
    xlab(paste("RNA-seq log2FC\n",sep = "")) +
    scale_shape_manual(values = c(1, 21)) +
    scale_color_manual(values = colsi,"Tx_class") +
    scale_fill_manual(values = colsi,"Tx_class") +
  geom_hline(yintercept = 0,size=.5) + geom_vline(xintercept = 0,size=.5) +
  coord_cartesian(xlim = c(-10,10),ylim=c(-10,10)) +
  facet_wrap(.~experiment,nrow = 1)

p <- ggplot(dfa_te, 
            aes(
              x = RNA_log2FC, 
              y = Ribo_log2FC)) + 
    geom_hex(bins = 40) + 
  scale_fill_distiller(
                    palette = 'PuBuGn',
                    direction = 1, 
                    #values = c(0, 0.5), 
                    element_text(size=5)) +
    xlab(label = "log10 base expression") + 
    ylab(label = "log2 fold change DUX4/control")  + 
    mytheme + 
    geom_hline(yintercept=0, linetype="dashed", color = "black") +
    facet_wrap(~as_factor(experiment)) +
    geom_point(dfa_select, 
             mapping = aes(
                           x = RNA_log2FC, 
                           y = Ribo_log2FC, 
                           color = tx_type_RiboRNA),
             size=1,
             alpha=0.8) +
   scale_color_manual(values = colsi,"Tx_class") 

p 

pdf(file = "data/rna_ribo_scatter.pdf",width = 9,height = 3.5)
print(p)
dev.off()

# table to use for n for various categories  
te_table <- dfa_te %>% filter(significance == "true")
table(te_table$tx_type_RiboRNA, te_table$experiment)

  #                 time04h_vs_time00h time08h_vs_time00h time14h_vs_time00h
  # TE_down                          1                 21                137
  # TE_up                            0                  2                 28
  # Concordant_down                  0                  0                  0
  # Concordant_up                    0                  0                  0
  # mixed_NS                         0                  0                  0

# exporting data for GO analysis
write.csv(te_table, file = "data/te_table.csv")

# step 1 - make the long table wide
DE_table_wide <- dfa[, c(22, 18, 9, 12, 14)]

cor(DE_table_wide %>% filter(condition == "time04h") %>% select(RNA_log2FC, Ribo_log2FC), use = "pairwise.complete.obs", method = "pearson")
# 0.7474313

cor(DE_table_wide %>% filter(condition == "time08h") %>% select(RNA_log2FC, Ribo_log2FC), use = "pairwise.complete.obs", method = "pearson")
# 0.8932658

cor(DE_table_wide %>% filter(condition == "time14h") %>% select(RNA_log2FC, Ribo_log2FC), use = "pairwise.complete.obs", method = "pearson")
# 0.9181838

```

##### Figure S2

```{r}
load("data/QC_metacds.RData")

xinter<-c(1,20,70,170,216,236)
res_breaks <- xinter
res_labels <- c("TSS", "", "start\ncodon", "stop\ncodon", "", "TES")

ggplot(data=qc_metadf, 
             aes(x=position, y=mean,color=frame,fill=frame)) +
    geom_vline(xintercept=xinter, lty=3, color="black") +
    geom_bar(stat="identity") +
    geom_errorbar( aes(x=position, ymin=mean-sddevv, ymax=mean+sddevv), width=0.8, alpha=0.9) +
    scale_x_continuous(breaks=res_breaks, labels=res_labels) +
    labs(x="", y="P-sites coverage\n") +
    scale_color_manual(values = alpha(c("#440154","#FDE725","#29AF7F"),.8),"") +
    scale_fill_manual(values = alpha(c("#440154","#FDE725","#29AF7F"),.8),"") +
    mytheme + 
    facet_wrap(.~ condition,ncol = 2) + theme(legend.position = "none")

```

##### Figure 3 and S3
```{r}

load( "data/DE_ORFDEX.RData")
load("data/df_notover_CDSs.RData")
load("data/df_cpm_log2fc.RData")

# read coverage over PTC and NTC
ggplot(total_plot_df) +
  geom_bar(stat="identity", aes(x=x_vals, y=ribo_vals, color=frame, fill=frame)) +
  scale_color_viridis(discrete = TRUE, option="D") +
  scale_fill_viridis(discrete = TRUE, option="D") +
  geom_line(aes(x=x_vals, y=rna_vals), color="dark grey", alpha=0.7, group=1)+
  facet_grid(group_txs~time_point,scales = "fixed") +
  labs(x="Distance from stop codon",
       y=paste("Average normalized count (289 genes)",sep = "")) +
  theme_classic() + geom_vline(xintercept = 0,lty=2) +
  geom_area(aes(x=x_vals, y=rna_vals),color="grey",alpha=.1) 

df<-ORFDEX

colsa<-alpha(c("#042333", "dark grey"),c(.7,.4))
names(colsa)<-c("NMD","canonical")

# M-A plot
ggplot(df %>% arrange(NMD_cand),
       aes(x=exonBaseMean+1, y=log2FC,
           color=NMD_cand,
           fill=NMD_cand)) + 
  geom_point(size = 2) +
  mytheme +
  scale_color_manual(values = colsa,"NMD status") +
  scale_fill_manual(values = colsa,"NMD status") +
  scale_shape_manual(values = c(1, 21)) + 
  facet_wrap(~condition,ncol = 1) + 
  scale_x_log10(breaks=c(1,11,101,1001,10001),labels=c(1,11,101,1001,10001)-1) +
  xlab(label = "log10 base expression") + 
  ylab(label = "log2 fold change DUX4/control")  + mytheme + geom_hline(yintercept=0, linetype="dashed", color = "black")


# boxplot
ggplot(df,aes(y=log2FC,x=NMD_cand,group=NMD_cand,fill=NMD_cand)) +
    geom_jitter(alpha=.06, pch = 20) +
    stat_summary(position=position_dodge(.6),size=.7, alpha = 1, pch= 21, color= "black") +
    scale_fill_manual(values = colsa,"ORF group") +
    theme_classic() +
    xlab("") +
    ylab("Ribo-seq log2FC") +
    theme(axis.title.x = element_text(size=22),axis.text.x  = element_text(angle=45, vjust=0.5, size=13)) +
    theme(axis.title.y = element_text(size=18),axis.text.y  = element_text(angle=0, vjust=0.5, size=15))  +
    theme(strip.text.x = element_text(size=10, face="bold"),strip.text.y = element_text(size=24),strip.background = element_rect(colour="black", fill="white")) + #stat_compare_means(label="p.signif",method = "wilcox.test",hide.ns = F,comparisons = comps,label.y = 6) + 
  facet_wrap(.~condition,ncol = 4) + coord_cartesian(ylim=c(-7,7)) + theme(axis.title.x=element_blank(),axis.text.x=element_blank(),
                                            axis.ticks.x=element_blank())

## GO analysis
nmd_exons_GO_analysis <- read_delim("data/nmd-exons-GO-analysis.txt",
"\t", escape_double = FALSE, trim_ws = TRUE)

names(nmd_exons_GO_analysis) <- c("GOBP", "genes-in-group", "genes-in-data", "expected", "fold-enrichment", "p-val", "fdr", "neglog10FDR")

nmd_exons_GO_analysis$GOBP <- factor(nmd_exons_GO_analysis$GOBP, levels = nmd_exons_GO_analysis$GOBP)

ggplot(data = nmd_exons_GO_analysis, aes(x = GOBP, y = neglog10FDR)) + geom_bar(stat="identity", fill = "#04233370") + mytheme

# fig S3E
ggplot(df_cpm_log2fc, aes(x=time, y=log2FCs, fill=type)) +
  geom_boxplot() + theme_minimal_hgrid() + scale_fill_manual(values = c("steelblue","dark grey")) +
  labs(x="Time after DUX4 induction", y="CPM at stop codon\nlog2FC to 00h", fill="Category") +
  stat_compare_means(aes(label = after_stat(p.signif)), method = "wilcox.test",paired = T, method.args = list(alternative = "less"),label.y = 6 )+
  facet_wrap(~seqtype,nrow = 2)
```

##### Figure 4

```{r}
#input data
polysome_traces <- read_excel("data/polysome-traces.xlsx")
names(polysome_traces) <- c("fraction", "0h", "4h", "8h", "14h")
polysome_traces_long <- polysome_traces %>% pivot_longer(-fraction, names_to = "time", values_to = "amount")

total_rna <- read_excel("data/total-rna.xlsx")
names(total_rna) <- c("fraction", "condition", "molecule", "amount")

colsa<-alpha(c("dark grey", "#042333"),c(1,1))
#names(colsa)<-c("target","non-target")

p1 <- ggplot(data = polysome_traces_long %>% filter(time %in% c("14h", "0h")), 
            aes(x = fraction, y = amount, color = time)) + 
  #geom_line(size = 1.5) + 
  #geom_point(size = 1) + 
geom_area(aes(fill = time), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "Absorbance 254 nm") + 
  xlab(label = "Fraction Number") +
  mytheme + theme(legend.position = "none")

p2 <- ggplot(data = (total_rna %>% filter(molecule == "RPL27")), 
            aes(x = fraction, y = amount, color = condition)) + 
  #geom_line(size = 1.5) + 
  #geom_point(size = 1) + 
geom_area(aes(fill = condition), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "% of RPL27 mRNA") + 
  xlab(label = "Fraction number")  +
  mytheme + theme(legend.position = "none")


p3 <- ggplot(data = (total_rna %>% filter(molecule == "DUX4")), 
            aes(x = fraction, y = amount, color = condition)) + 
geom_area(aes(fill = condition), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "% of DUX4 mRNA") + 
  xlab(label = "Fraction number")  +
  mytheme + theme(legend.position = "none")


p4 <- ggplot(data = (total_rna %>% filter(molecule == "ZSCAN4")), 
            aes(x = fraction, y = amount, color = condition)) + 
geom_area(aes(fill = condition), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "% of ZSCAN4 mRNA") + 
  xlab(label = "Fraction number")  +
  mytheme + theme(legend.position = "none")

p5 <- ggplot(data = (total_rna %>% filter(molecule == "SRSF3-Excl")), 
            aes(x = fraction, y = amount, color = condition)) + 
geom_area(aes(fill = condition), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "% of SRSF3-Excl mRNA") + 
  xlab(label = "Fraction number")  +
  mytheme + theme(legend.position = "none")

p6 <- ggplot(data = (total_rna %>% filter(molecule == "SRSF3-Incl")), 
            aes(x = fraction, y = amount, color = condition)) + 
geom_area(aes(fill = condition), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "% of SRSF3-Incl mRNA") + 
  xlab(label = "Fraction number")  +
  mytheme + theme(legend.position = "none")

legend_p7 <- ggplot(data = (total_rna %>% filter(molecule == "SRSF3-Incl")), 
            aes(x = fraction, y = amount, color = condition)) + 
geom_area(aes(fill = condition), alpha = 0.3, position = "identity")+ 
  scale_fill_manual(values = colsa,"DUX4 target status") +
  scale_color_manual(values = colsa,"DUX4 target status") +
  theme_bw(base_size = 12) +
  #ggtitle("DUX4") + 
  ylab(label = "% of SRSF3-Incl mRNA") + 
  xlab(label = "Fraction number")  +
  mytheme

legend_p7

fig1_nolegend <- plot_grid(p1, p2, p3, p4, p5, p6, 
                           #labels = c("B","C", "D", "E", "F", "G"), 
                           nrow = 3)

fig1_withlegend <- plot_grid(fig1_nolegend, legend, ncol = 1, rel_heights = c(1, .1))

fig1_nolegend
```
